<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>EntertainHub | Inicio</title>

</head>

<body>
    <header class="responsive-header">
        <h1>EntertainHub</h1>

        <div class="perfil-bar">
            <span class="perfil-nombre">üë§ {{ perfilNombre }}</span>
            <div class="botones-header">
                <button (click)="cambiarPin()">Cambiar PIN</button>
                <button (click)="volverAPerfiles()">Cambiar Perfil</button>
                <button (click)="logout()">Cerrar Sesi√≥n</button>
            </div>
        </div>
    </header>

    <!-- Overlay para cambio de PIN -->
    <!-- Overlay para cambio de PIN -->
    <div class="pin-overlay" *ngIf="mostrarOverlayPin">
        <div class="pin-modal">
            <h2>Cambiar PIN</h2>

            <!-- Paso 1: PIN actual -->
            <div *ngIf="!pinValidado">
                <label>PIN actual</label>
                <div class="pin-inputs">
                    <input maxlength="1" [(ngModel)]="pinActual[0]" (input)="handleInput(pinActual, 0, $event)" />
                    <input maxlength="1" [(ngModel)]="pinActual[1]" (input)="handleInput(pinActual, 1, $event)" />
                    <input maxlength="1" [(ngModel)]="pinActual[2]" (input)="handleInput(pinActual, 2, $event)" />
                    <input maxlength="1" [(ngModel)]="pinActual[3]" (input)="handleInput(pinActual, 3, $event)" />
                </div>
                <div class="botones">
                    <button (click)="validarPin()" [disabled]="cargandoPin">
                        <span *ngIf="cargandoPin" class="spinner"></span>
                        <span *ngIf="!cargandoPin">Validar</span>
                    </button>
                    <button class="cancelar" (click)="cerrarOverlay()">Cancelar</button>
                </div>
            </div>

            <!-- Paso 2: Nuevo PIN -->
            <div *ngIf="pinValidado">
                <label>Nuevo PIN</label>
                <div class="pin-inputs">
                    <input maxlength="1" [(ngModel)]="pinNuevo[0]" (input)="handleInput(pinNuevo, 0, $event)" />
                    <input maxlength="1" [(ngModel)]="pinNuevo[1]" (input)="handleInput(pinNuevo, 1, $event)" />
                    <input maxlength="1" [(ngModel)]="pinNuevo[2]" (input)="handleInput(pinNuevo, 2, $event)" />
                    <input maxlength="1" [(ngModel)]="pinNuevo[3]" (input)="handleInput(pinNuevo, 3, $event)" />
                </div>
                <div class="botones">
                    <button (click)="guardarPin()" [disabled]="cargandoGuardar">
                        <span *ngIf="cargandoGuardar" class="spinner"></span>
                        <span *ngIf="!cargandoGuardar">Guardar</span>
                    </button>
                    <button class="cancelar" (click)="cerrarOverlay()">Cancelar</button>
                </div>
            </div>

            <p *ngIf="mensajePin" [ngStyle]="{ color: esErrorPin ? '#f44336' : '#4caf50' }">
                {{ mensajePin }}
            </p>

        </div>
    </div>
    <div style="display: flex; justify-content: flex-end; align-items: center; padding: 10px 40px;">
        <label style="color: white; margin-right: 10px;">Modo Offline</label>
        <label class="switch">
            <input type="checkbox" [(ngModel)]="modoOffline" (ngModelChange)="toggleModoOffline()" />
            <span class="slider round"></span>
        </label>
    </div>
    <ng-container *ngIf="!modoOffline">
        <!-- DASHBOARD ANAL√çTICO -->
        <section class="dashboard-analitico">
            <!-- Primera fila -->
            <div class="dash-cards">
                <div class="dash-card">
                    <h3>üéß Audios reproducidos</h3>
                    <p>{{ dashboard?.totalAudio }}</p>
                </div>
                <div class="dash-card">
                    <h3>üé¨ Videos vistos</h3>
                    <p>{{ dashboard?.totalVideo }}</p>
                </div>
                <div class="dash-card">
                    <h3>üïí Tiempo total</h3>
                    <p>{{ convertirTiempo(dashboard?.tiempoTotal) }}</p>
                </div>
            </div>

            <!-- Segunda fila: audio y video m√°s reproducidos -->
            <div class="dash-cards" style="margin-top: 30px;">
                <div class="dash-card" *ngIf="dashboard?.audioMasReproducido">
                    <h3>üéµ Audio m√°s reproducido</h3>
                    <p style="font-size: 16px;">{{ dashboard.audioMasReproducido.titulo }}</p>
                    <p style="font-size: 14px; color: #aaa;">Duraci√≥n total: {{
                        convertirTiempo(dashboard.audioMasReproducido.duracion) }}</p>
                </div>
                <div class="dash-card" *ngIf="dashboard?.videoMasReproducido">
                    <h3>üéûÔ∏è Video m√°s reproducido</h3>
                    <p style="font-size: 16px;">{{ dashboard.videoMasReproducido.titulo }}</p>
                    <p style="font-size: 14px; color: #aaa;">Duraci√≥n total: {{
                        convertirTiempo(dashboard.videoMasReproducido.duracion) }}</p>
                </div>
            </div>
        </section>





        <div class="section-title">üéß Tus Playlists</div>
        <div class="carousel">
            <div class="item" *ngFor="let pl of playlists" (click)="abrirOverlayPlaylist(pl)">
                <img [src]="pl.portada" alt="Playlist" />
                <div class="audio-badge" *ngIf="pl.tipo === 'audio'">AUDIO</div>
                <div class="video-badge" *ngIf="pl.tipo === 'video'">VIDEO</div>
                <div class="mixta-badge" *ngIf="pl.tipo === 'mixta'">MIXTA</div>

                <div class="overlay">{{ pl.nombre }}</div>
            </div>
        </div>

        <div class="section-title" *ngIf="mostrarAudio && audios.length">üéµ M√∫sica y Podcasts</div>
        <div class="carousel" *ngIf="mostrarAudio && audios.length">
            <div class="item" *ngFor="let audio of audios" (click)="reproducirContenido(audio)">
                <img [src]="audio.portada" alt="Audio" />
                <div class="audio-badge">AUDIO</div>
                <div class="overlay">{{ audio.titulo }}</div>
            </div>
        </div>

        <div class="section-title" *ngIf="mostrarVideo && videos.length">üé¨ Pel√≠culas y Series</div>
        <div class="carousel" *ngIf="mostrarVideo && videos.length">
            <div class="item" *ngFor="let video of videos" (click)="reproducirContenido(video)">
                <img [src]="video.portada" alt="Video" />
                <div class="video-badge">VIDEO</div>
                <div class="overlay">{{ video.titulo }}</div>
            </div>
        </div>
        <div class="section-title">‚ú® Recomendado para ti</div>
        <div class="carousel">
            <div class="item" *ngFor="let reco of recomendaciones" (click)="reproducirContenido(reco)">
                <img [src]="reco.portada" alt="Recomendaci√≥n" />
                <div class="audio-badge" *ngIf="reco.tipo === 'audio'">AUDIO</div>
                <div class="video-badge" *ngIf="reco.tipo === 'video'">VIDEO</div>
                <div class="overlay">{{ reco.titulo }}</div>
            </div>
        </div>
        <div class="pin-overlay" *ngIf="mostrarOverlayPlaylist">
            <div class="playlist scrollable-modal">
                <h2>{{ playlistSeleccionada?.nombre }}</h2>

                <div class="playlist-list">
                    <div class="playlist-item" (click)="reproducirContenidoDesdePlaylist(c, playlistSeleccionada.id)"
                        *ngFor="let c of playlistSeleccionada?.contenidos">
                        <img [src]="c.portada" alt="Portada" />
                        <div class="info">
                            <strong>{{ c.titulo }}</strong>
                            <p>{{ c.descripcion }}</p>
                            <span class="badge"
                                [ngClass]="{'audio': c.tipo === 'audio', 'video': c.tipo === 'video'}">{{
                                c.tipo.toUpperCase() }}</span>
                        </div>
                    </div>
                </div>

                <button class="cancelar" (click)="cerrarOverlayPlaylist()">Cerrar</button>
            </div>
        </div>
    </ng-container>
    <ng-container *ngIf="modoOffline">
        <div class="section-title">üéß Contenido descargado (Offline)</div>

        <div class="carousel">
            <div class="item" *ngFor="let c of contenidosDescargados" (click)="reproducirContenido(c)">
                <img [src]="c.portada" />
                <div class="audio-badge" *ngIf="c.tipo === 'audio'">AUDIO</div>
                <div class="video-badge" *ngIf="c.tipo === 'video'">VIDEO</div>
                <div class="overlay">‚úî {{ c.titulo }}</div>
            </div>
        </div>
    </ng-container>
</body>